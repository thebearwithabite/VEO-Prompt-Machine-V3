# Feature Documentation: Smart Asset Library (VEO Prompt Machine)

## Overview
The Smart Asset Library transforms the application from a simple image generator into a structured pre-production database. Instead of uploading a generic pool of "3 ingredient images," users now define specific **Characters** and **Locations**. The system then intelligently maps these assets to specific shots based on the script analysis.

## Core Components

### 1. Data Structure: `ProjectAsset`
Located in `types.ts`.

```typescript
export type AssetType = 'character' | 'location' | 'prop' | 'style';

export interface ProjectAsset {
  id: string;           // Unique identifier (e.g., 'asset-12345-xyz')
  name: string;         // e.g., "Detective Stone"
  description: string;  // AI-inferred visual description from script
  type: AssetType;      // 'character' or 'location'
  image: IngredientImage | null; // The base64 image data
}
```

### 2. AI Extraction Service
Located in `services/geminiService.ts` -> `extractAssetsFromScript`.

*   **Model:** `gemini-3-pro-preview`
*   **Input:** Raw script text.
*   **Output:** JSON Array of assets `{ name, description, type }`.
*   **Function:** Analyzes the script to determine the "Cast List" and "Set List" before visualization begins.

### 3. Asset Library UI
Located in `components/AssetLibrary.tsx`.

*   **Visual Grid:** Displays assets as cards.
*   **States:**
    *   *Empty/Detected:* Shows name/description but no image (User needs to upload).
    *   *Filled:* Shows the uploaded reference image.
*   **Actions:**
    *   **Auto-Detect:** Calls the AI service to populate the grid.
    *   **Manual Add:** User can manually create a new character/location slot.
    *   **Upload:** User assigns a file to a slot.

### 4. Intelligent Mapping Logic
Located in `App.tsx` -> `handleGenerate`.

During the generation loop, after the VEO JSON for a shot is created:

1.  The system reads the `veoJson.character.name` and `veoJson.scene.context`.
2.  It performs a fuzzy string match against the `assets` list.
3.  **Match Found:** The `asset.id` is automatically pushed to the shot's `selectedAssetIds` array.
4.  **Generation:** When `generateKeyframeImage` is called, it resolves these IDs to the actual image data to use as "ingredients" for that specific shot.

### 5. Manual Override (Shot Book)
Located in `components/VideoResult.tsx` -> `ShotCard`.

*   Users can toggle specific assets on/off for any given shot.
*   If the auto-detection missed a connection (e.g., "He enters the room" refers to "The Office"), the user can manually click "The Office" asset to include it in the regeneration.

## Future Integration: AI File Organizer
To integrate this with an AI File Organizer:

1.  **Metadata Tagging:** Use the `description` field generated by Gemini as metadata for the file.
2.  **Folder Structure:** Use `type` ('character', 'location') to auto-sort assets into folders.
3.  **Naming Convention:** Use `name` (sanitized) for the filename.
